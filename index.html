<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§€ì˜ì´ì˜ ì˜ì–´ í•œ ì…</title>
    <style>
        body { font-family: 'Apple SD Gothic Neo', sans-serif; text-align: center; padding: 20px; background-color: #fff9f9; color: #333; }
        .container { max-width: 500px; margin: auto; background: white; padding: 30px; border-radius: 30px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); border: 2px solid #ffccd5; }
        .welcome { font-size: 24px; font-weight: bold; color: #ff4757; margin-bottom: 20px; }
        .card { background: #fff5f5; padding: 20px; border-radius: 20px; margin-bottom: 20px; }
        .meaning { font-size: 22px; color: #444; margin-bottom: 5px; font-weight: bold; }
        .english { font-size: 28px; font-weight: bold; color: #007aff; margin-bottom: 10px; }
        .pronunciation { font-size: 20px; color: #888; margin-bottom: 20px; }
        
        /* ë‹¨ì–´ ì„¤ëª… ìŠ¤íƒ€ì¼ */
        .word-box { text-align: left; background: #f1f2f6; padding: 15px; border-radius: 15px; margin-bottom: 20px; font-size: 18px; }
        .word-item { margin-bottom: 8px; line-height: 1.4; }
        .word-en { font-weight: bold; color: #2f3542; margin-right: 5px; }

        .btn { background: #ff4757; color: white; border: none; padding: 20px; font-size: 22px; border-radius: 20px; width: 100%; cursor: pointer; font-weight: bold; box-shadow: 0 4px 0 #e03a49; }
        .btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #e03a49; }
        #feedback { margin-top: 25px; font-size: 19px; line-height: 1.6; color: #2d3436; min-height: 60px; padding: 15px; background: #f0f2f5; border-radius: 15px; border-left: 5px solid #ff4757; }
        .stamps { font-size: 40px; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="welcome">ğŸŒ¸ ì§€ì˜ ë‹˜, ì˜¤ëŠ˜ë„ í™”ì´íŒ…! ğŸŒ¸</div>
        
        <div class="card">
            <p class="meaning">ì‹¤ë¡€ì§€ë§Œ, ê¸¸ ì¢€ ì•Œë ¤ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”?</p>
            <p class="english" id="targetText">Excuse me, can you tell me the way?</p>
            <p class="pronunciation">[ ìµìŠ¤íì¦ˆ ë¯¸, ìº” ìœ  í…” ë¯¸ ë” ì›¨ì´? ]</p>
        </div>

        <div class="word-box">
            <div class="word-item"><span class="word-en">Excuse me:</span> ì‹¤ë¡€í•©ë‹ˆë‹¤</div>
            <div class="word-item"><span class="word-en">Tell:</span> ë§í•˜ë‹¤/ì•Œë ¤ì£¼ë‹¤</div>
            <div class="word-item"><span class="word-en">Way:</span> ê¸¸/ë°©ë²•</div>
        </div>
        
        <button class="btn" onclick="startRecognition()">ğŸ¤ ëˆŒëŸ¬ì„œ ë§í•´ë³´ê¸°</button>
        <div id="feedback">ì•„ë˜ ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ë¬¸ì¥ì„ í¬ê²Œ ì½ì–´ë³´ì„¸ìš”!</div>
        
        <div class="stamps" id="stamps">âšª âšª âšª âšª âšª</div>
    </div>

    <script>
        const API_KEY = "AIzaSyD4t-Mn7mUBBEk0c3m0n-yZHWN9zo0IB-c"; 
        let stampCount = 0;

        async function startRecognition() {
            const feedbackDiv = document.getElementById('feedback');
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'en-US';

            feedbackDiv.innerText = "ì§€ì˜ ë‹˜ì˜ ëª©ì†Œë¦¬ë¥¼ ë“£ê³  ìˆì–´ìš”...";
            recognition.start();

            recognition.onresult = async (event) => {
                const userSpeech = event.results[0][0].transcript;
                const targetText = document.getElementById('targetText').innerText;
                
                feedbackDiv.innerText = "ì œë¯¸ë‚˜ì´ ì„ ìƒë‹˜ì´ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...";

                const feedback = await getGeminiFeedback(userSpeech, targetText);
                feedbackDiv.innerText = feedback;
                
                if (stampCount < 5) {
                    stampCount++;
                    document.getElementById('stamps').innerHTML = "ğŸ’®".repeat(stampCount) + "âšª".repeat(5 - stampCount);
                }
            };
        }

        async function getGeminiFeedback(userSpeech, targetText) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;
            const prompt = `ë‹¹ì‹ ì€ 60ëŒ€ í•œêµ­ì¸ ì—¬ì„± 'ì§€ì˜' ë‹˜ì„ ìœ„í•œ ë‹¤ì •í•œ ì˜ì–´ ì„ ìƒë‹˜ì…ë‹ˆë‹¤. 
                           ëª©í‘œ: "${targetText}", ì§€ì˜ ë‹˜ì˜ ë°œìŒ: "${userSpeech}". 
                           ì§€ì˜ ë‹˜ì˜ ì´ë¦„ì„ ë¶€ë¥´ë©° ì¹œì ˆí•˜ê²Œ ì¹­ì°¬í•´ì£¼ê³ , ë°œìŒ êµì • íŒì„ í•œêµ­ì–´ë¡œ 2ë¬¸ì¥ ë‚´ë¡œ ì•„ì£¼ ì‰½ê²Œ ë§í•´ì£¼ì„¸ìš”. 
                           ë§ˆì§€ë§‰ì—” í•­ìƒ "ì§€ì˜ ë‹˜, ì°¸ ì˜í•˜ì…¨ì–´ìš”! ğŸ’®"ë¼ê³  í•´ì£¼ì„¸ìš”.`;

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (e) {
                return "ì§€ì˜ ë‹˜, ëª©ì†Œë¦¬ê°€ ì •ë§ ì¢‹ìœ¼ì‹œë„¤ìš”! ìì‹ ê° ìˆê²Œ í•˜ì‹  ì ì´ ìµœê³ ì˜ˆìš”. ì°¸ ì˜í•˜ì…¨ì–´ìš”! ğŸ’®";
            }
        }
    </script>
</body>
</html>