<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§€ì˜ì´ì˜ ì˜ì–´ í•œ ì…</title>
    <style>
        body { font-family: 'Apple SD Gothic Neo', sans-serif; text-align: center; padding: 20px; background-color: #fff9f9; color: #333; }
        .container { max-width: 500px; margin: auto; background: white; padding: 30px; border-radius: 30px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); border: 2px solid #ffccd5; }
        .welcome { font-size: 24px; font-weight: bold; color: #ff4757; margin-bottom: 20px; }
        .card { background: #fff5f5; padding: 25px; border-radius: 20px; margin-bottom: 20px; min-height: 150px; display: flex; flex-direction: column; justify-content: center; }
        .meaning { font-size: 22px; color: #444; margin-bottom: 8px; font-weight: bold; }
        .english { font-size: 28px; font-weight: bold; color: #007aff; margin-bottom: 10px; }
        .pronunciation { font-size: 20px; color: #888; }
        
        .word-box { text-align: left; background: #f1f2f6; padding: 15px; border-radius: 15px; margin-bottom: 20px; font-size: 18px; min-height: 100px; }
        .word-item { margin-bottom: 8px; }
        .word-en { font-weight: bold; color: #2f3542; }

        .btn-group { display: flex; gap: 10px; margin-bottom: 15px; }
        .nav-btn { flex: 1; padding: 15px; font-size: 18px; border-radius: 15px; border: 1px solid #ddd; cursor: pointer; background: white; }
        .speak-btn { background: #00b894; color: white; border: none; padding: 20px; font-size: 22px; border-radius: 20px; width: 100%; cursor: pointer; font-weight: bold; margin-bottom: 10px; }
        .tts-btn { background: #74ebd5; color: #2f3542; border: none; padding: 10px; border-radius: 10px; cursor: pointer; font-size: 16px; margin-top: 10px; }
        
        #feedback { margin-top: 20px; font-size: 18px; line-height: 1.5; color: #2d3436; padding: 15px; background: #f0f2f5; border-radius: 15px; border-left: 5px solid #ff4757; }
        .stamps { font-size: 40px; margin-top: 15px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="welcome">ğŸŒ¸ ì§€ì˜ ë‹˜, ì˜ì–´ í•œ ì…! ğŸŒ¸</div>
        
        <div class="card">
            <p class="meaning" id="lbl-meaning"></p>
            <p class="english" id="lbl-english"></p>
            <p class="pronunciation" id="lbl-pronunciation"></p>
            <button class="tts-btn" onclick="playTTS()">ğŸ”Š ì›ì–´ë¯¼ ë°œìŒ ë“£ê¸°</button>
        </div>

        <div class="word-box" id="lbl-words"></div>
        
        <div class="btn-group">
            <button class="nav-btn" onclick="prevStep()">â¬…ï¸ ì´ì „</button>
            <button class="nav-btn" onclick="nextStep()">ë‹¤ìŒ â¡ï¸</button>
        </div>

        <button class="speak-btn" onclick="startRecognition()">ğŸ¤ ë‚´ ë°œìŒ í™•ì¸í•˜ê¸°</button>
        <div id="feedback">ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ë¬¸ì¥ì„ ì½ì–´ë³´ì„¸ìš”!</div>
        
        <div class="stamps" id="stamps">âšª âšª âšª âšª âšª</div>
    </div>

    <script>
        const API_KEY = "AIzaSyD4t-Mn7mUBBEk0c3m0n-yZHWN9zo0IB-c"; 
        let currentIndex = 0;
        let stamps = [false, false, false, false, false];

        const data = [
            { 
                en: "Excuse me, can you tell me the way?", 
                ko: "ì‹¤ë¡€ì§€ë§Œ, ê¸¸ ì¢€ ì•Œë ¤ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”?", 
                pr: "ìµìŠ¤íì¦ˆ ë¯¸, ìº” ìœ  í…” ë¯¸ ë” ì›¨ì´?",
                words: "<b>Excuse me:</b> ì‹¤ë¡€í•©ë‹ˆë‹¤<br><b>Tell:</b> ì•Œë ¤ì£¼ë‹¤<br><b>Way:</b> ê¸¸" 
            },
            { 
                en: "Where is the nearest station?", 
                ko: "ê°€ì¥ ê°€ê¹Œìš´ ì—­ì´ ì–´ë””ì¸ê°€ìš”?", 
                pr: "ì›¨ì–´ ì´ì¦ˆ ë” ë‹ˆì–´ë¦¬ìŠ¤íŠ¸ ìŠ¤í…Œì´ì…˜?",
                words: "<b>Where:</b> ì–´ë””<br><b>Nearest:</b> ê°€ì¥ ê°€ê¹Œìš´<br><b>Station:</b> ì—­" 
            },
            { 
                en: "How long does it take?", 
                ko: "ì–¼ë§ˆë‚˜ ì˜¤ë˜ ê±¸ë¦¬ë‚˜ìš”?", 
                pr: "í•˜ìš° ë¡± ë”ì¦ˆ ì‡ í…Œì´í¬?",
                words: "<b>How long:</b> ì–¼ë§ˆë‚˜ ê¸¸ê²Œ<br><b>Take:</b> (ì‹œê°„ì´) ê±¸ë¦¬ë‹¤" 
            },
            { 
                en: "Can I walk there?", 
                ko: "ê±°ê¸°ê¹Œì§€ ê±¸ì–´ê°ˆ ìˆ˜ ìˆë‚˜ìš”?", 
                pr: "ìº” ì•„ì´ ì›Œí¬ ë°ì–´?",
                words: "<b>Walk:</b> ê±·ë‹¤<br><b>There:</b> ê±°ê¸°" 
            },
            { 
                en: "I'm lost. Help me, please.", 
                ko: "ê¸¸ì„ ìƒì—ˆì–´ìš”. ë„ì™€ì£¼ì„¸ìš”.", 
                pr: "ì•„ì„ ë¡œìŠ¤íŠ¸. í—¬í”„ ë¯¸, í”Œë¦¬ì¦ˆ.",
                words: "<b>Lost:</b> ê¸¸ì„ ìƒì€<br><b>Help:</b> ë•ë‹¤" 
            }
        ];

        function updateUI() {
            const item = data[currentIndex];
            document.getElementById('lbl-meaning').innerText = item.ko;
            document.getElementById('lbl-english').innerText = item.en;
            document.getElementById('lbl-pronunciation').innerText = item.pr;
            document.getElementById('lbl-words').innerHTML = item.words;
            updateStamps();
            document.getElementById('feedback').innerText = (currentIndex + 1) + "ë²ˆ ë¬¸ì¥ì…ë‹ˆë‹¤. ê³µë¶€ë¥¼ ì‹œì‘í•´ë³¼ê¹Œìš”?";
        }

        function nextStep() {
            if (currentIndex < data.length - 1) { currentIndex++; updateUI(); }
        }

        function prevStep() {
            if (currentIndex > 0) { currentIndex--; updateUI(); }
        }

        function playTTS() {
            const utterance = new SpeechSynthesisUtterance(data[currentIndex].en);
            utterance.lang = 'en-US';
            utterance.rate = 0.8; // ì§€ì˜ ë‹˜ì´ ë“£ê¸° í¸í•˜ê²Œ ì¡°ê¸ˆ ì²œì²œíˆ
            window.speechSynthesis.speak(utterance);
        }

        function updateStamps() {
            document.getElementById('stamps').innerHTML = stamps.map(s => s ? "ğŸ’®" : "âšª").join(" ");
        }

        async function startRecognition() {
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'en-US';
            document.getElementById('feedback').innerText = "ì§€ì˜ ë‹˜ì˜ ëª©ì†Œë¦¬ë¥¼ ë“£ê³  ìˆì–´ìš”...";
            recognition.start();

            recognition.onresult = async (event) => {
                const userSpeech = event.results[0][0].transcript;
                const targetText = data[currentIndex].en;
                document.getElementById('feedback').innerText = "AI ì„ ìƒë‹˜ì´ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...";

                const feedback = await getGeminiFeedback(userSpeech, targetText);
                document.getElementById('feedback').innerText = feedback;
                
                stamps[currentIndex] = true;
                updateStamps();
            };
        }

        async function getGeminiFeedback(userSpeech, targetText) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;
            const prompt = `ë‹¹ì‹ ì€ 60ëŒ€ ì—¬ì„± 'ì§€ì˜' ë‹˜ì˜ ë‹¤ì •í•œ ì˜ì–´ ì„ ìƒë‹˜ì…ë‹ˆë‹¤. ëª©í‘œ: "${targetText}", ì§€ì˜ ë‹˜ì˜ ë°œìŒ: "${userSpeech}". ì§€ì˜ ë‹˜ì˜ ì´ë¦„ì„ ë¶€ë¥´ë©° ë”°ëœ»í•˜ê²Œ ì¹­ì°¬í•˜ê³  ë°œìŒ íŒì„ í•œêµ­ì–´ë¡œ 1ë¬¸ì¥ìœ¼ë¡œ ë§í•´ì£¼ì„¸ìš”. ë§ˆì§€ë§‰ì— "ì°¸ ì˜í•˜ì…¨ì–´ìš”! ğŸ’®"ë¼ê³  í•´ì£¼ì„¸ìš”.`;
            try {
                const res = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }) });
                const json = await res.json();
                return json.candidates[0].content.parts[0].text;
            } catch (e) { return "ì§€ì˜ ë‹˜, ì •ë§ í›Œë¥­í•´ìš”! ì°¸ ì˜í•˜ì…¨ì–´ìš”! ğŸ’®"; }
        }

        updateUI(); // ì´ˆê¸° í™”ë©´ ì‹¤í–‰
    </script>
</body>
</html>