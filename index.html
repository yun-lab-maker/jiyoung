<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§€ì˜ì´ì˜ ì˜ì–´ê³µë¶€</title>
    <style>
        body { font-family: 'Apple SD Gothic Neo', sans-serif; text-align: center; padding: 20px; background-color: #fff9f9; color: #333; }
        .container { max-width: 500px; margin: auto; background: white; padding: 30px; border-radius: 30px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); border: 2px solid #ffccd5; }
        .card { background: #fff5f5; padding: 25px; border-radius: 20px; margin-bottom: 20px; min-height: 180px; display: flex; flex-direction: column; justify-content: center; }
        .meaning { font-size: 22px; color: #444; margin-bottom: 8px; font-weight: bold; }
        .english { font-size: 28px; font-weight: bold; color: #007aff; margin-bottom: 10px; line-height: 1.2; }
        .pronunciation { font-size: 20px; color: #888; margin-bottom: 15px; }
        .word-box { text-align: left; background: #f1f2f6; padding: 20px; border-radius: 15px; margin-bottom: 20px; font-size: 18px; min-height: 100px; }
        .btn-group { display: flex; gap: 10px; margin-bottom: 15px; }
        .nav-btn { flex: 1; padding: 15px; font-size: 18px; border-radius: 15px; border: 1px solid #ddd; cursor: pointer; background: white; }
        .speak-btn { background: #ff4757; color: white; border: none; padding: 20px; font-size: 22px; border-radius: 20px; width: 100%; cursor: pointer; font-weight: bold; }
        .tts-btn { background: #e1f5fe; color: #0288d1; border: none; padding: 10px 20px; border-radius: 50px; cursor: pointer; font-size: 18px; font-weight: bold; margin-bottom: 10px; border: 1px solid #b3e5fc; }
        #feedback { margin-top: 20px; font-size: 19px; line-height: 1.6; color: #2d3436; padding: 15px; background: #f0f2f5; border-radius: 15px; border-left: 5px solid #ff4757; min-height: 60px; }
        .stamps { font-size: 40px; margin-top: 15px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <p id="loading-msg" style="font-size: 18px; color: #888;">AIê°€ ì§€ì˜ ë‹˜ì„ ìœ„í•œ ì˜¤ëŠ˜ì˜ ë¬¸ì¥ì„ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤...</p>
            <div id="content-area" style="display:none;">
                <p class="meaning" id="lbl-meaning"></p>
                <p class="english" id="lbl-english"></p>
                <p class="pronunciation" id="lbl-pronunciation"></p>
                <button class="tts-btn" onclick="playTTS()">ğŸ”Š ì›ì–´ë¯¼ ë°œìŒ ë“£ê¸°</button>
            </div>
        </div>

        <div class="word-box" id="lbl-words"></div>
        
        <div class="btn-group">
            <button class="nav-btn" onclick="prevStep()">â¬…ï¸ ì´ì „</button>
            <button class="nav-btn" onclick="nextStep()">ë‹¤ìŒ â¡ï¸</button>
        </div>

        <button class="speak-btn" onclick="startRecognition()">ğŸ¤ ë‚´ ë°œìŒ í™•ì¸í•˜ê¸°</button>
        <div id="feedback">ì¤€ë¹„ê°€ ë˜ë©´ ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ì½ì–´ì£¼ì„¸ìš”!</div>
        <div class="stamps" id="stamps">âšª âšª âšª âšª âšª</div>
    </div>

    <script>
        const API_KEY = "AIzaSyD4t-Mn7mUBBEk0c3m0n-yZHWN9zo0IB-c"; //
        let currentIndex = 0;
        let dailyData = [];
        let stamps = [false, false, false, false, false];

        // 1. ë§¤ì¼ ë‹¤ë¥¸ ë¬¸ì¥ 5ê°œ ê°€ì ¸ì˜¤ê¸° (Gemini API)
        async function fetchDailySentences() {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;
            const prompt = "60ëŒ€ í•œêµ­ì¸ì„ ìœ„í•œ ì‹¤ìš© ì—¬í–‰ ì˜ì–´ 5ë¬¸ì¥ì„ JSON ë°°ì—´ í˜•íƒœë¡œ ìƒì„±í•´ì¤˜. ê° ê°ì²´ëŠ” en(ì˜ì–´), ko(í•œê¸€ëœ»), pr(í•œê¸€ë°œìŒ), words(ì£¼ìš”ë‹¨ì–´ ëœ» ì„¤ëª…) í•„ë“œë¥¼ ê°€ì ¸ì•¼ í•´. ë‹¤ë¥¸ ì„¤ëª… ì—†ì´ JSON ì½”ë“œë§Œ ë³´ë‚´ì¤˜.";
            
            try {
                const res = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }) });
                const json = await res.json();
                let text = json.candidates[0].content.parts[0].text;
                dailyData = JSON.parse(text.replace(/```json|```/g, ""));
                document.getElementById('loading-msg').style.display = 'none';
                document.getElementById('content-area').style.display = 'block';
                updateUI();
            } catch (e) {
                console.error("ë°ì´í„° ë¡œë”© ì‹¤íŒ¨", e);
                document.getElementById('loading-msg').innerText = "ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
            }
        }

        function updateUI() {
            const item = dailyData[currentIndex];
            document.getElementById('lbl-meaning').innerText = item.ko;
            document.getElementById('lbl-english').innerText = item.en;
            document.getElementById('lbl-pronunciation').innerText = item.pr;
            document.getElementById('lbl-words').innerHTML = item.words;
            document.getElementById('stamps').innerHTML = stamps.map(s => s ? "ğŸ’®" : "âšª").join(" ");
            document.getElementById('feedback').innerText = (currentIndex + 1) + "ë²ˆ ë¬¸ì¥ì…ë‹ˆë‹¤.";
        }

        // 2. ì„ ëª…í•˜ê³  ë§‘ì€ í†¤ì˜ ì›ì–´ë¯¼ ë°œìŒ ì„¤ì •
        function playTTS() {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(dailyData[currentIndex].en);
            const voices = window.speechSynthesis.getVoices();
            // ê°€ì¥ í´ë¦¬ì–´í•œ ëª©ì†Œë¦¬ ì°¾ê¸°
            const preferredVoice = voices.find(v => v.name.includes('Google US English') || v.name.includes('Samantha'));
            if (preferredVoice) utterance.voice = preferredVoice;
            
            utterance.lang = 'en-US';
            utterance.rate = 0.85; // ë‹¨ì–´ êµ¬ë¶„ì´ ì˜ ë˜ê²Œ ì•½ê°„ ì²œì²œíˆ
            utterance.pitch = 1.15; // ë§‘ê³  ëª…ë‘í•œ ê³ ìŒì—­ëŒ€ í†¤ìœ¼ë¡œ ì„¤ì •
            window.speechSynthesis.speak(utterance);
        }

        function nextStep() { if (currentIndex < 4) { currentIndex++; updateUI(); } }
        function prevStep() { if (currentIndex > 0) { currentIndex--; updateUI(); } }

        async function startRecognition() {
            const rec = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            rec.lang = 'en-US';
            document.getElementById('feedback').innerText = "ë“£ê³  ìˆì–´ìš”... ë§ì”€í•˜ì„¸ìš”!";
            rec.start();

            rec.onresult = async (event) => {
                const userSpeech = event.results[0][0].transcript;
                document.getElementById('feedback').innerText = "AI ì„ ìƒë‹˜ì´ ë¶„ì„ ì¤‘...";
                const feedback = await getGeminiFeedback(userSpeech, dailyData[currentIndex].en);
                document.getElementById('feedback').innerText = feedback;
                stamps[currentIndex] = true;
                updateUI();
            };
        }

        async function getGeminiFeedback(userSpeech, targetText) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;
            const prompt = `60ëŒ€ ì§€ì˜ ë‹˜ì„ ìœ„í•œ ì„ ìƒë‹˜ì´ì•¼. ë¬¸ì¥ "${targetText}"ë¥¼ í•™ìƒì´ "${userSpeech}"ë¼ê³  ë°œìŒí–ˆì–´. ë‹¤ì •í•˜ê²Œ ì¹­ì°¬ê³¼ êµì • íŒì„ í•œê¸€ 2ë¬¸ì¥ìœ¼ë¡œ ë§í•˜ê³  ë§ˆì§€ë§‰ì—” ê¼­ "ì°¸ ì˜í•˜ì…¨ì–´ìš”! ğŸ’®"ë¼ê³  í•´ì¤˜.`;
            const res = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }) });
            const json = await res.json();
            return json.candidates[0].content.parts[0].text;
        }

        window.speechSynthesis.onvoiceschanged = () => {}; // ëª©ì†Œë¦¬ ë¡œë”© ëŒ€ê¸°ìš©
        fetchDailySentences();
    </script>
</body>
</html>
