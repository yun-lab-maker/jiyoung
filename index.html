<script>
    // 1. ì—¬ê¸°ì— ì§€ì˜ ë‹˜ì˜ API í‚¤ë¥¼ ë„£ì–´ì£¼ì„¸ìš”!
    const API_KEY = "AIzaSyD4t-Mn7mUBBEk0c3m0n-yZHWN9zo0IB-c"; 

    async function fetchDialogue() {
        try {
            // [í¬ì¸íŠ¸] ì£¼ì†Œë¥¼ v1betaë¡œ, ëª¨ë¸ì„ gemini-1.5-flash-latestë¡œ ì•„ì£¼ ì •í™•íˆ ì§€ì •í–ˆìŠµë‹ˆë‹¤.
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${API_KEY}`;
            
            const prompt = "Generate a 6-line travel English dialogue between Staff and Jiyoung. Situation: Random (Airport, Taxi, or Shopping). Output ONLY JSON: { \"situation\": \"string\", \"lines\": [ { \"en\": \"string\", \"ko\": \"í•œêµ­ì–´\", \"pr\": \"ë°œìŒ\" } ] }";

            const res = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });

            const json = await res.json();
            
            // ë§Œì•½ ì—¬ê¸°ì„œë„ ì—ëŸ¬ê°€ ë‚˜ë©´ ì§€ì˜ ë‹˜ì´ ë³´ì‹œëŠ” ì•ŒëŸ¿ì°½ì— êµ¬ì²´ì ì¸ ì´ìœ ê°€ ëœ° ê±°ì˜ˆìš”.
            if (json.error) {
                alert("êµ¬ê¸€ ì„œë²„ ì‘ë‹µ: " + json.error.message);
                return;
            }

            const rawText = json.candidates[0].content.parts[0].text.replace(/```json/g, "").replace(/```/g, "").trim();
            const data = JSON.parse(rawText);
            
            // ì„±ê³µí•˜ë©´ í™”ë©´ì— ë„ìš°ê¸°
            dialogue = data.lines;
            document.getElementById('lbl-situation').innerText = "ğŸ“ ìƒí™©: " + data.situation;
            document.getElementById('loading').style.display = 'none';
            render();

        } catch (e) {
            alert("ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í‚¤ë¥¼ ë‹¤ì‹œ í•œë²ˆ í™•ì¸í•´ ì£¼ì„¸ìš”!");
            console.error(e);
        }
    }
    fetchDialogue();
</script>
